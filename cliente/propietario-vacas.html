<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mis Vacas — Ganadería JFB</title>

  <!-- RUTA RELATIVA -->
  <link rel="stylesheet" href="../css/estilos.css" />

  <style>
    /* Mini estilos para el listado compacto (por si tu CSS aún no los trae) */
    .vaca-list{display:flex; flex-direction:column; gap:12px;}
    .vaca-row{
      display:grid; grid-template-columns: 1.1fr .9fr 1fr 1fr 1fr auto;
      gap:12px; align-items:center;
      background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.08);
      border-radius:12px; padding:12px 14px;
    }
    .vaca-col{min-width:0; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
    .row-actions{display:flex; gap:10px; justify-content:flex-end;}
    .badge{
      display:inline-block; padding:4px 10px; border-radius:999px; font-size:.78rem; font-weight:700;
      background:rgba(79,70,229,.18); color:#cbd5ff; border:1px solid rgba(79,70,229,.35);
    }
    .historial-panel{
      display:none; margin-top:10px; padding:12px; border-radius:10px;
      background:rgba(255,255,255,.03); border:1px solid rgba(255,255,255,.08);
      grid-column: 1 / -1; /* ocupa todo el ancho bajo la fila */
    }
    @media (max-width: 820px){
      .vaca-row{grid-template-columns: 1fr 1fr; align-items:start}
      .row-actions{grid-column: 1 / -1; justify-content:flex-start}
    }
    /* Modal básico */
    .modal-oculto{display:none; position:fixed; inset:0; background:rgba(0,0,0,.6); z-index:1000; }
    .modal-contenido{background:#111827; color:#e5e7eb; margin:5vh auto; padding:18px; border-radius:14px; width:92%;}
    .cerrar-modal{float:right; cursor:pointer; font-size:24px;}
    .hr{height:1px;background:rgba(255,255,255,.1);margin:12px 0;}
  </style>
</head>
<body>
  <header class="main-header">
    <button onclick="history.back()" class="btn-ghost btn-mini">← Volver</button>
    <h1>Mis Vacas</h1>
    <button id="boton-logout" class="boton-logout btn-mini">Cerrar Sesión</button>
  </header>

  <!-- Buscador local -->
  <section class="card">
    <h2>Buscar</h2>
    <div class="form-grid">
      <div class="campo full">
        <input type="text" id="filtro-vacas" placeholder="Filtra por SINIIGA, pierna, nombre o raza…">
      </div>
    </div>
  </section>

  <!-- Listado (lo llena propietario-vacas.js) -->
  <section class="card">
    <h2>Listado</h2>
    <div id="vacas-list" class="vaca-list"></div>
  </section>

  <footer class="footer-nav">
    <a href="./propietario-anadir.html" class="boton-secundario">Añadir Vaca</a>
    <a href="./propietario-dashboard.html" class="btn-ghost">Ir al Panel</a>
  </footer>

  <!-- Socket si usas tiempo real -->
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>

  <!-- JS del listado compacto (RUTA RELATIVA) -->
  <script src="./propietario-vacas.js" defer></script>

  <!-- Utilidades: filtro + logout + modal básico -->
  <script>
    
    // Logout
    document.getElementById('boton-logout')?.addEventListener('click', () => {
      localStorage.removeItem('token');
      sessionStorage.clear();
      location.href = './index.html';
    });

    // Filtro local
    document.addEventListener('DOMContentLoaded', () => {
      const input = document.getElementById('filtro-vacas');
      const list = document.getElementById('vacas-list');
      if (!input || !list) return;
      input.addEventListener('input', () => {
        const q = input.value.toLowerCase().trim();
        [...list.querySelectorAll('.vaca-row')].forEach(row => {
          const text = row.innerText.toLowerCase();
          row.style.display = text.includes(q) ? '' : 'none';
        });
      });

      // Modal cerrar (si lo usas en propietario-vacas.js)
      const modal = document.getElementById('historial-modal');
      const cerrar = document.getElementById('historial-cerrar');
      cerrar?.addEventListener('click', () => modal.style.display = 'none');
      modal?.addEventListener('click', (e) => { if (e.target === modal) modal.style.display = 'none'; });
    });
  </script>

  <!-- Modal Historial (pro) -->
  <div id="historial-modal" class="modal-oculto">
    <div class="modal-contenido" style="max-width:760px;">
      <span id="historial-cerrar" class="cerrar-modal">&times;</span>
      <h2 style="border:none;margin-top:0">Historial de la vaca <span id="historial-titulo"></span></h2>

      <!-- Resumen arriba -->
      <div id="historial-resumen" style="display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 14px"></div>
      <div class="hr"></div>

      <!-- Timeline -->
      <div id="historial-contenido" class="timeline"></div>
    </div>
  </div>
</body>
</html>
